services:
  # AI Service (FastAPI)
  ai-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: shelterai-ai-service
    environment:
      # La base de datos debe estar corriendo externamente o en localhost
      DATABASE_URL: postgresql://root:root@host.docker.internal:5432/shelterai
      MODEL_PATH: /app/models/shelter_model.pkl
      API_HOST: 0.0.0.0
      API_PORT: 8000
    ports:
      - "8000:8000"
    volumes:
      - ./models:/app/models:ro
      - ./inference_api:/app/inference_api:ro
    restart: unless-stopped
    extra_hosts:
      # Permite acceder a servicios en localhost desde el contenedor
      - "host.docker.internal:host-gateway"

# Comandos útiles:
# docker compose up -d                 # Iniciar el servicio de IA
# docker compose logs -f ai-service    # Ver logs del AI service
# docker compose down                  # Detener el servicio
# docker compose restart ai-service    # Reiniciar AI service
# docker compose build                 # Reconstruir la imagen si hay cambios

# NOTA: La base de datos PostgreSQL debe estar corriendo en localhost:5432
# Si usas la base de datos del api-service, asegúrate de que esté activa
